@model IEnumerable<SanPhamChiTiet>

<div class="col-sm-3">

	@Html.Partial("_sidebar")
</div>

<!-- Sản phẩm nổi bật -->
<div class="col-sm-9 padding-right">
	@if (TempData["Success"] != null)
	{
		<div class="alert alert-success alert-dismissible fade show" role="alert">
			@TempData["Success"]
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
	}
	<div class="features_items">
		<h2 class="title text-center">Sản phẩm nổi bật</h2>
		@foreach (var item in Model)
		{
			<div class="col-sm-4">
				<div class="product-image-wrapper">
					<div class="single-products">
						<div class="productinfo text-center">

							<img src="@item.Anh" />
							<h2>@item.Gia.ToString("N0")</h2>
							<p style="font-size: 15px; font-weight: bold;">@item.SanPham?.TenSanPham</p>


							<button class="btn btn-default add-to-cart" onclick="addToCart(@item.SanPhamChiTietId)"><i class="fa fa-shopping-cart"></i>Thêm vào giỏ</button>

						</div>

						<div class="product-overlay">
							<div class="overlay-content">
								<h2>@item.Gia.ToString("N0")</h2>
								<p style="font-size: 15px; font-weight: bold;">@item.SanPham?.TenSanPham</p>
								<p>@item.SanPham?.MoTa</p>
								<p>@item.SanPham?.Brand?.TenThuongHieu</p>
								<button class="btn btn-default add-to-cart" onclick="addToCart(@item.SanPhamChiTietId)"><i class="fa fa-shopping-cart"></i>Thêm vào giỏ</button>

							</div>

						</div>
					</div>
				</div>

			</div>
		}
	</div><!-- /features_items -->
</div>

<script>
	$(document).ready(function () {
		$('.panel-title a').click(function (e) {
			var $target = $($(this).attr('href'));
			if ($target.hasClass('in')) {
				$target.collapse('hide');
			}
		});
	});

	function addToCart(sanPhamChiTietId) {
		fetch('@Url.Action("AddToCart", "Cart")', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/x-www-form-urlencoded',
			},
			body: `sanPhamChiTietId=${sanPhamChiTietId}&soLuong=1`
		})
		.then(response => response.json())
		.then(data => {
			if (data.success) {
				// Hiển thị thông báo thành công
				const alertDiv = document.createElement('div');
				alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed';
				alertDiv.style.top = '20px';
				alertDiv.style.right = '20px';
				alertDiv.style.zIndex = '9999';
				alertDiv.innerHTML = `
					<i class="fas fa-check-circle me-2"></i>${data.message}
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				`;
				document.body.appendChild(alertDiv);
				
				// Tự động ẩn sau 3 giây
				setTimeout(() => {
					if (alertDiv.parentNode) {
						alertDiv.parentNode.removeChild(alertDiv);
					}
				}, 3000);
			} else {
				alert(data.message || 'Có lỗi xảy ra');
			}
		})
		.catch(error => {
			console.error('Error:', error);
			alert('Có lỗi xảy ra khi thêm vào giỏ hàng');
		});
	}
</script>
