@model PhuLieuToc.Models.SubcategoryViewModel
@{
    ViewData["Title"] = "Chỉnh sửa Danh mục con";
    Layout = "_Layout";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-edit me-2"></i>Chỉnh sửa Danh mục con: @Model.Name
        </h1>
        <a href="/Admin/DanhMuc/Subcategories/@ViewBag.ParentCategoryId" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Quay lại
        </a>
    </div>

    <div class="card shadow">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-success">Thông tin danh mục con</h6>
        </div>
        <div class="card-body">
            <form id="editSubcategoryForm">
                @Html.AntiForgeryToken()
                <input type="hidden" id="subcategoryId" value="@ViewBag.SubcategoryId" />
                <input type="hidden" id="parentCategoryId" value="@ViewBag.ParentCategoryId" />

                <div class="form-group">
                    <label for="subcategoryName">Tên danh mục con</label>
                    <input type="text" class="form-control" id="subcategoryName" value="@Model.Name" required />
                </div>

                <div class="form-group">
                    <label for="subcategorySlug">Slug</label>
                    <input type="text" class="form-control" id="subcategorySlug" value="@Model.Slug" readonly />
                </div>

                <div class="form-group">
                    <label for="subcategoryDescription">Mô tả</label>
                    <textarea class="form-control" id="subcategoryDescription">@Model.Description</textarea>
                </div>

                <div class="form-group form-check">
                    <input class="form-check-input" type="checkbox" id="subcategoryActive" @(Model.Active ? "checked" : "") />
                    <label class="form-check-label" for="subcategoryActive">Đang hoạt động</label>
                </div>

                <button type="submit" class="btn btn-success">Cập nhật</button>
                <a href="/Admin/DanhMuc/Subcategories/@ViewBag.ParentCategoryId" class="btn btn-secondary">Hủy</a>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById('editSubcategoryForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const subcategoryData = {
        name: document.getElementById('subcategoryName').value,
        slug: document.getElementById('subcategorySlug').value,
        description: document.getElementById('subcategoryDescription').value,
        active: document.getElementById('subcategoryActive').checked
    };

    const id = document.getElementById('subcategoryId').value;
    const token = document.querySelector('input[name="__RequestVerificationToken"]').value;

    const response = await fetch(`/Admin/DanhMuc/EditSubcategory/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'RequestVerificationToken': token
        },
        body: JSON.stringify(subcategoryData)
    });

    const result = await response.json();
    if (result.success) {
        alert(result.message);
        window.location.href = `/Admin/DanhMuc/Subcategories/${document.getElementById('parentCategoryId').value}`;
    } else {
        alert('Lỗi: ' + result.message);
    }
});
</script>
